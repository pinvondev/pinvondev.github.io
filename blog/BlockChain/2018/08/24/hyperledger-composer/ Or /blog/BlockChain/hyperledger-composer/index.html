<!DOCTYPE html>
<html lang="en">
<head>
  <title>Hyperledger Composer - Pinvon&#39;s Blog</title>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
  <meta name="author" content="Pinvon" />
  <meta name="description" content="&lt;Add description here&gt;" />
  <meta name="keywords" content="BlockChain" />
  <style>
   #ds-thread #ds-reset .ds-comment-body p {color: #ffffff;}
   #ds-thread #ds-reset .ds-comment-body p a {color: #ff0;}
   #ds-thread #ds-reset .ds-comment-body p a:hover {color: #0ff;}
   #disqus_thread a {color: #00ffff;}
  </style>
  <link rel="stylesheet" href="https://pinvondev.github.io/media/css/main.css" type="text/css"/>
  <link rel="stylesheet" href="https://pinvondev.github.io/media/css/comment.css" type="text/css"/>
</head>

  <body><div class="container">
<div>
  <header class="masthead">
    <h1 class="masthead-title"><a href="https://pinvondev.github.io/">Pinvon&#39;s Blog</a></h1>
    <p>所见, 所闻, 所思, 所想</p>
    <nav class="site-nav">
      <div class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z" fill="#ffff00"/>
          <path d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z" fill="#ffff00"/>
          <path d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z" fill="#ffff00"/>
        </svg>
      </div>
      <ul class="trigger">
        <li><a href="https://pinvondev.github.io/years/">Years</a></li>
        <li><a href="https://pinvondev.github.io/authors/">Authors</a></li>
        <li><a href="https://pinvondev.github.io/tags/">Tags</a></li>
        <li><a href="https://pinvondev.github.io/about/">About</a></li>
        <li><a href="https://github.com/pinvondev">Github</a></li>
        <li><a href="https://pinvondev.github.io/rss.xml">RSS</a></li>
      </ul>
    </nav>
    <form method="get" id="searchform" action="http://www.google.com/search">
      <input type="text" class="field" name="q" id="s" placeholder="Search">
      <input type="hidden" name="as_sitesearch" value="pinvondev.github.io">
    </form>
  </header>
</div>

<div>
<div class="post">
<h1 class="title">Hyperledger Composer</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgadafc3e">安装</a>
<ul>
<li><a href="#orgd687761">前提条件</a></li>
<li><a href="#orgc6d5a9a">安装组件</a>
<ul>
<li><a href="#org8a1f5a1">安装 CLI tools</a></li>
<li><a href="#org904d068">安装 Plyaground</a></li>
<li><a href="#org8c42d0c">安装 Hyperledger Fabric</a></li>
</ul>
</li>
<li><a href="#orga24a4ae">使用</a>
<ul>
<li><a href="#orgb340717">启动和停止 Hyperledger Fabric</a></li>
<li><a href="#orga252a27">启动 Playground</a></li>
</ul>
</li>
<li><a href="#orge45de8c">删除当前设置</a></li>
</ul>
</li>
<li><a href="#org5d57483">Playground 教程</a>
<ul>
<li><a href="#org03b578a">打开 Playground</a></li>
<li><a href="#orgf06fb09">创建新的业务网络</a></li>
<li><a href="#org0995908">连接到刚部署的网络</a></li>
<li><a href="#org346a53e">添加模型文件</a></li>
<li><a href="#orgf4d7956">添加处理逻辑</a></li>
<li><a href="#org6ab2c53">访问控制</a></li>
<li><a href="#org15f5017">部署和更新业务网络</a></li>
<li><a href="#org1bf55e8">测试</a>
<ul>
<li><a href="#orgb1967db">添加资产</a></li>
<li><a href="#org6bbd0a3">添加参与者</a></li>
<li><a href="#orgf11f5e7">在两个参与者之间转移资产</a></li>
</ul>
</li>
<li><a href="#orgfe435c3">基于已有 Fabric 创建业务网络</a></li>
</ul>
</li>
<li><a href="#orgf2e1c9f">使用命令的方式创建业务网络</a>
<ul>
<li><a href="#org69ea71e">配置环境</a></li>
<li><a href="#org7fdb389">创建网络结构</a></li>
<li><a href="#orgb57558c">定义网络</a></li>
<li><a href="#org61038c9">生成网络</a></li>
<li><a href="#orgffdfa36">部署业务网络</a></li>
<li><a href="#org9448056">生成 REST 服务</a></li>
<li><a href="#org62eca73">生成应用程序</a></li>
</ul>
</li>
<li><a href="#org68b1a3e">使用 Composer 为单个 Org 部署业务网络</a>
<ul>
<li><a href="#orga917b88">启动 Hyperledger Fabric Network</a></li>
<li><a href="#org3d5fc26">创建 .bna 文件</a></li>
<li><a href="#org37c8c32">创建 connection.json</a></li>
<li><a href="#org4ebf3a6">创建业务网卡</a></li>
<li><a href="#org6da58d9">将业务网卡导入给 Fabric 管理员</a></li>
<li><a href="#org1bb107c">将业务网络安装到节点上</a></li>
<li><a href="#org3a1de32">将 card 文件导入到业务网络</a></li>
<li><a href="#org227a51a">测试</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-orgadafc3e" class="outline-2">
<h2 id="orgadafc3e">安装</h2>
<div class="outline-text-2" id="text-orgadafc3e">
</div>
<div id="outline-container-orgd687761" class="outline-3">
<h3 id="orgd687761">前提条件</h3>
<div class="outline-text-3" id="text-orgd687761">
<div class="org-src-container">
<pre class="src src-Shell">curl -O https://hyperledger.github.io/composer/latest/prereqs-ubuntu.sh
chmod u+x prereqs-ubuntu.sh
./prereqs-ubuntu.sh
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc6d5a9a" class="outline-3">
<h3 id="orgc6d5a9a">安装组件</h3>
<div class="outline-text-3" id="text-orgc6d5a9a">
</div>
<div id="outline-container-org8a1f5a1" class="outline-4">
<h4 id="org8a1f5a1">安装 CLI tools</h4>
<div class="outline-text-4" id="text-org8a1f5a1">
<p>
composer-cli 是最重要的组件, 包含了基本的操作.
generator-hyperledger-composer, composer-rest-server, yeoman 这三个虽然不是核心部分, 但在后面与我们自己定义的网络交互时, 可以起到作用.
</p>
<div class="org-src-container">
<pre class="src src-Shell">npm install -g composer-cli@0.20
npm install -g composer-rest-server@0.20
npm install -g generator-hyperledger-composer@0.20
npm install -g yo
</pre>
</div>

<p>
如果要卸载:
</p>
<div class="org-src-container">
<pre class="src src-Shell">npm uninstall -g composer-cli composer-rest-server generator-hyperledger-composer
</pre>
</div>
</div>
</div>

<div id="outline-container-org904d068" class="outline-4">
<h4 id="org904d068">安装 Plyaground</h4>
<div class="outline-text-4" id="text-org904d068">
<p>
Playground 可以为我们提供 UI 视图.
</p>
<div class="org-src-container">
<pre class="src src-Shell">npm install -g composer-playground@0.20
</pre>
</div>
</div>
</div>

<div id="outline-container-org8c42d0c" class="outline-4">
<h4 id="org8c42d0c">安装 Hyperledger Fabric</h4>
<div class="outline-text-4" id="text-org8c42d0c">
<div class="org-src-container">
<pre class="src src-Shell">mkdir fabric-dev-servers &amp;&amp; cd fabric-dev-servers

curl -O https://raw.githubusercontent.com/hyperledger/composer-tools/master/packages/fabric-dev-servers/fabric-dev-servers.tar.gz
 tar -xvf fabric-dev-servers.tar.gz

cd ~/fabric-dev-servers
export FABRIC_VERSION=hlfv12
./downloadFabric.sh
</pre>
</div>

<p>
这边安装的是 Hyperledger Fabric v1.2 的版本.
</p>
</div>
</div>
</div>

<div id="outline-container-orga24a4ae" class="outline-3">
<h3 id="orga24a4ae">使用</h3>
<div class="outline-text-3" id="text-orga24a4ae">
</div>
<div id="outline-container-orgb340717" class="outline-4">
<h4 id="orgb340717">启动和停止 Hyperledger Fabric</h4>
<div class="outline-text-4" id="text-orgb340717">
<div class="org-src-container">
<pre class="src src-Shell">cd ~/fabric-dev-servers
export FABRIC_VERSION=hlfv12
./startFabric.sh
./createPeerAdminCard.sh

# 关闭
./stopFabric.sh 
./teardownFabric.sh
</pre>
</div>
</div>
</div>

<div id="outline-container-orga252a27" class="outline-4">
<h4 id="orga252a27">启动 Playground</h4>
<div class="outline-text-4" id="text-orga252a27">
<p>
在启动 Hyperledger Fabric 后, 运行:
</p>
<div class="org-src-container">
<pre class="src src-Shell">composer-playground
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orge45de8c" class="outline-3">
<h3 id="orge45de8c">删除当前设置</h3>
<div class="outline-text-3" id="text-orge45de8c">
<div class="org-src-container">
<pre class="src src-Shell">docker kill $(docker ps -q)
docker rm $(docker ps -aq)
docker rmi $(docker images dev-* -q)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org5d57483" class="outline-2">
<h2 id="org5d57483">Playground 教程</h2>
<div class="outline-text-2" id="text-org5d57483">
<p>
利用 Playground, 我们可以建立一个业务网络, 定义资产, 参与者, 交易, 并进行测试.
</p>
</div>

<div id="outline-container-org03b578a" class="outline-3">
<h3 id="org03b578a">打开 Playground</h3>
<div class="outline-text-3" id="text-org03b578a">
<div class="org-src-container">
<pre class="src src-Shell">composer-playground
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf06fb09" class="outline-3">
<h3 id="orgf06fb09">创建新的业务网络</h3>
<div class="outline-text-3" id="text-orgf06fb09">
<p>
Deploy a new business network
</p>

<p>
输入名称
</p>

<p>
empty-business-network(从零开始才选择这项, 也可以基于其他网络创建)
</p>

<p>
Deploy
</p>
</div>
</div>

<div id="outline-container-org0995908" class="outline-3">
<h3 id="org0995908">连接到刚部署的网络</h3>
<div class="outline-text-3" id="text-org0995908">
<p>
单击 connect now
</p>
</div>
</div>

<div id="outline-container-org346a53e" class="outline-3">
<h3 id="org346a53e">添加模型文件</h3>
<div class="outline-text-3" id="text-org346a53e">
<p>
(最好自己写一份上传)
</p>

<p>
单击 Model file, 并用以下代码来替换它们:
</p>
<div class="org-src-container">
<pre class="src src-Shell">/**
 * My commodity trading network
 */
namespace org.example.mynetwork
asset Commodity identified by tradingSymbol {
    o String tradingSymbol
    o String description
    o String mainExchange
    o Double quantity
    --&gt; Trader owner
}
participant Trader identified by tradeId {
    o String tradeId
    o String firstName
    o String lastName
}
transaction Trade {
    --&gt; Commodity commodity
    --&gt; Trader newOwner
}
</pre>
</div>
<p>
这个模型定义了一个资产 Commodity, 一个参与者 Trader, 一个交易 Trade.
</p>
</div>
</div>

<div id="outline-container-orgf4d7956" class="outline-3">
<h3 id="orgf4d7956">添加处理逻辑</h3>
<div class="outline-text-3" id="text-orgf4d7956">
<p>
Composer 使用 JavaScript 来表达业务网络的逻辑, 提交事务进行处理时, 将自动执行这些功能.
</p>

<p>
Add a file -&gt; Script file -&gt; Add
</p>

<p>
用以下代码来替换:
</p>
<div class="org-src-container">
<pre class="src src-Shell">/**
 * Track the trade of a commodity from one trader to another
 * @param {org.example.mynetwork.Trade} trade - the trade to be processed
 * @transaction
 */
async function tradeCommodity(trade) {
    trade.commodity.owner = trade.newOwner;
    let assetRegistry = await getAssetRegistry('org.example.mynetwork.Commodity');
    await assetRegistry.update(trade.commodity);
}
</pre>
</div>
<p>
这段代码使用新的所有者 trade.newOwner 来替换原有的所有者 trade.commodity.owner, 然后将修改后的 trade.commodity 保存.
</p>
</div>
</div>

<div id="outline-container-org6ab2c53" class="outline-3">
<h3 id="org6ab2c53">访问控制</h3>
<div class="outline-text-3" id="text-org6ab2c53">
<p>
这个例子中的网络很简单, 因此不需要修改默认的访问控制.
</p>
</div>
</div>

<div id="outline-container-org15f5017" class="outline-3">
<h3 id="org15f5017">部署和更新业务网络</h3>
<div class="outline-text-3" id="text-org15f5017">
<p>
单击左下角的 Deploy changes.
</p>
</div>
</div>

<div id="outline-container-org1bf55e8" class="outline-3">
<h3 id="org1bf55e8">测试</h3>
<div class="outline-text-3" id="text-org1bf55e8">
</div>
<div id="outline-container-orgb1967db" class="outline-4">
<h4 id="orgb1967db">添加资产</h4>
<div class="outline-text-4" id="text-orgb1967db">
<p>
单击 Test 导航栏.
</p>

<p>
添加两个参与者.
</p>

<p>
单击 Trader -&gt; Create New Participant, 用以下代码来替换, 然后单击 Create new.
</p>
<div class="org-src-container">
<pre class="src src-Shell">{
  "$class": "org.example.mynetwork.Trader",
  "tradeId": "TRADER1",
  "firstName": "Jenny",
  "lastName": "Jones"
}
</pre>
</div>

<p>
创建第二个参与者:
</p>
<div class="org-src-container">
<pre class="src src-Shell">{
  "$class": "org.example.mynetwork.Trader",
  "tradeId": "TRADER2",
  "firstName": "Amy",
  "lastName": "Williams"
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org6bbd0a3" class="outline-4">
<h4 id="org6bbd0a3">添加参与者</h4>
<div class="outline-text-4" id="text-org6bbd0a3">
<p>
Commodity -&gt; Assets -&gt; Create New Asset
</p>

<p>
使用以下代码替换:
</p>
<div class="org-src-container">
<pre class="src src-Shell">{
  "$class": "org.example.mynetwork.Commodity",
  "tradingSymbol": "ABC",
  "description": "Test commodity",
  "mainExchange": "Euronext",
  "quantity": 72.297,
  "owner": "resource:org.example.mynetwork.Trader#TRADER1"
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf11f5e7" class="outline-4">
<h4 id="orgf11f5e7">在两个参与者之间转移资产</h4>
<div class="outline-text-4" id="text-orgf11f5e7">
<p>
Submit Transaction, 用以下代码替换:
</p>
<div class="org-src-container">
<pre class="src src-Shell">{
  "$class": "org.example.mynetwork.Trade",
  "commodity": "resource:org.example.mynetwork.Commodity#ABC",
  "newOwner": "resource:org.example.mynetwork.Trader#TRADER2"
}
</pre>
</div>

<p>
Submit -&gt; All Transactions
</p>
</div>
</div>
</div>

<div id="outline-container-orgfe435c3" class="outline-3">
<h3 id="orgfe435c3">基于已有 Fabric 创建业务网络</h3>
<div class="outline-text-3" id="text-orgfe435c3">
<p>
如果已有 Fabric, 那么我们已经有了 PeerAdmin 和 ChannelAdmin, 在部署之前, 需要再填写一些其他字段.
</p>

<p>
要提供网络管理员的凭证时, 我们应该填写: Enrollment ID, admin Enrollment Secret, adminpw
</p>
</div>
</div>
</div>

<div id="outline-container-orgf2e1c9f" class="outline-2">
<h2 id="orgf2e1c9f">使用命令的方式创建业务网络</h2>
<div class="outline-text-2" id="text-orgf2e1c9f">
</div>
<div id="outline-container-org69ea71e" class="outline-3">
<h3 id="org69ea71e">配置环境</h3>
<div class="outline-text-3" id="text-org69ea71e">
<div class="org-src-container">
<pre class="src src-Shell">export FABRIC_VERSION=hlfv12
./startFabric.sh
./createPeerAdminCard.sh
</pre>
</div>
</div>
</div>

<div id="outline-container-org7fdb389" class="outline-3">
<h3 id="org7fdb389">创建网络结构</h3>
<div class="outline-text-3" id="text-org7fdb389">
<div class="org-src-container">
<pre class="src src-Shell">yo hyperledger-composer:businessnetwork
</pre>
</div>

<p>
按照提示, 输入网络名字等信息, 其中, namespace 输入 org.example.mynetwork, generate an empty template network 中, 选择 No.
</p>
</div>
</div>

<div id="outline-container-orgb57558c" class="outline-3">
<h3 id="orgb57558c">定义网络</h3>
<div class="outline-text-3" id="text-orgb57558c">
<p>
使用以下代码代替 org.example.mynetwork.cto 文件里的内容:
</p>
<div class="org-src-container">
<pre class="src src-Shell">/**
 * My commodity trading network
 */
namespace org.example.mynetwork
asset Commodity identified by tradingSymbol {
    o String tradingSymbol
    o String description
    o String mainExchange
    o Double quantity
    --&gt; Trader owner
}
participant Trader identified by tradeId {
    o String tradeId
    o String firstName
    o String lastName
}
transaction Trade {
    --&gt; Commodity commodity
    --&gt; Trader newOwner
}
</pre>
</div>

<p>
我们使用 JavaScript 来执行 .cto 文件中定义的交易. 将 lib/logic.js 中的内容替换如下:
</p>
<div class="org-src-container">
<pre class="src src-Shell">/**
 * Track the trade of a commodity from one trader to another
 * @param {org.example.mynetwork.Trade} trade - the trade to be processed
 * @transaction
 */
async function tradeCommodity(trade) {
    trade.commodity.owner = trade.newOwner;
    let assetRegistry = await getAssetRegistry('org.example.mynetwork.Commodity');
    await assetRegistry.update(trade.commodity);
}
</pre>
</div>

<p>
使用以下代码替换 permissions.acl 中的内容:
</p>
<div class="org-src-container">
<pre class="src src-Shell">/**
 * Access control rules for tutorial-network
 */
rule Default {
    description: "Allow all participants access to all resources"
    participant: "ANY"
    operation: ALL
    resource: "org.example.mynetwork.*"
    action: ALLOW
}

rule SystemACL {
  description:  "System ACL to permit all access"
  participant: "ANY"
  operation: ALL
  resource: "org.hyperledger.composer.system.**"
  action: ALLOW
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org61038c9" class="outline-3">
<h3 id="org61038c9">生成网络</h3>
<div class="outline-text-3" id="text-org61038c9">
<p>
进入 tutorial-network 目录, 执行命令:
</p>
<div class="org-src-container">
<pre class="src src-Shell">composer archive create -t dir -n .
</pre>
</div>
<p>
将会在当前目录生成一个 .bna 文件.
</p>
</div>
</div>

<div id="outline-container-orgffdfa36" class="outline-3">
<h3 id="orgffdfa36">部署业务网络</h3>
<div class="outline-text-3" id="text-orgffdfa36">
<p>
一般来说, Fabric 管理员需要创建一个 PeerAdmin 身份, 来执行安装链码和启动链码的命令, 不过在这边, Composer 已经自动为我们创建好了.
</p>

<p>
部署网络, 启动网络:
</p>
<div class="org-src-container">
<pre class="src src-Shell">composer network install --card PeerAdmin@hlfv1 --archiveFile tutorial-network@0.0.1.bna

composer network start --networkName tutorial-network --networkVersion 0.0.1 --networkAdmin admin --networkAdminEnrollSecret adminpw --card PeerAdmin@hlfv1 --file networkadmin.card
</pre>
</div>

<p>
为了顺利使用这个网络, 需要将 .card 文件导入.
</p>
<div class="org-src-container">
<pre class="src src-Shell">composer card import --file networkadmin.card
</pre>
</div>

<p>
测试是否部署成功:
</p>
<div class="org-src-container">
<pre class="src src-Shell">composer network ping --card admin@tutorial-network
</pre>
</div>
</div>
</div>

<div id="outline-container-org9448056" class="outline-3">
<h3 id="org9448056">生成 REST 服务</h3>
<div class="outline-text-3" id="text-org9448056">
<div class="org-src-container">
<pre class="src src-Shell">composer-rest-server
</pre>
</div>
<p>
然后输入名字: admin@tutorial-network
</p>

<p>
use namespaces in the generated API: never use namespaces
</p>

<p>
secure the generated API: No
</p>

<p>
enable event publication: Yes
</p>

<p>
是否开启 TLS: No
</p>
</div>
</div>

<div id="outline-container-org62eca73" class="outline-3">
<h3 id="org62eca73">生成应用程序</h3>
<div class="outline-text-3" id="text-org62eca73">
<p>
再开一个终端, 进入 tutorial-network
</p>
<div class="org-src-container">
<pre class="src src-Shell">yo hyperledger-composer:angular
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org68b1a3e" class="outline-2">
<h2 id="org68b1a3e">使用 Composer 为单个 Org 部署业务网络</h2>
<div class="outline-text-2" id="text-org68b1a3e">
</div>
<div id="outline-container-orga917b88" class="outline-3">
<h3 id="orga917b88">启动 Hyperledger Fabric Network</h3>
<div class="outline-text-3" id="text-orga917b88">
<div class="org-src-container">
<pre class="src src-Shell">cd ~/fabric-dev-servers
export FABRIC_VERSION=hlfv12
./stopFabric.sh
./teardownFabric.sh
./downloadFabric.sh
./startFabric.sh

composer card delete -c PeerAdmin@fabric-network
composer card delete -c admin@tutorial-network

# 如果上面的删除命令失败了, 则索性把整个文件删除
rm -fr ~/.composer
</pre>
</div>
</div>
</div>

<div id="outline-container-org3d5fc26" class="outline-3">
<h3 id="org3d5fc26">创建 .bna 文件</h3>
<div class="outline-text-3" id="text-org3d5fc26">
<p>
根据前面"使用命令的方式创建业务网络"介绍的内容, 创建 .bna 文件.
</p>
</div>
</div>

<div id="outline-container-org37c8c32" class="outline-3">
<h3 id="org37c8c32">创建 connection.json</h3>
<div class="outline-text-3" id="text-org37c8c32">
<p>
编辑 connection.json
</p>
<div class="org-src-container">
<pre class="src src-Shell">{
    "name": "fabric-network",
    "x-type": "hlfv1",
    "version": "1.0.0",
    "peers": {
        "peer0.org1.example.com": {
            "url": "grpc://localhost:7051"
        }
    },
    "certificateAuthorities": {
        "ca.org1.example.com": {
            "url": "http://localhost:7054",
            "caName": "ca.org1.example.com"
        }
    },
    "orderers": {
        "orderer.example.com": {
            "url": "grpc://localhost:7050"
        }
    },
    "organizations": {
        "Org1": {
            "mspid": "Org1MSP",
            "peers": [
                "peer0.org1.example.com"
            ],
            "certificateAuthorities": [
                "ca.org1.example.com"
            ]
        }
    },
    "channels": {
        "composerchannel": {
            "orderers": [
                "orderer.example.com"
            ],
            "peers": {
                "peer0.org1.example.com": {
                    "endorsingPeer": true,
                    "chaincodeQuery": true,
                    "eventSource": true
                }
            }
        }
    },
    "client": {
        "organization": "Org1",
        "connection": {
            "timeout": {
                "peer": {
                    "endorser": "300",
                    "eventHub": "300",
                    "eventReg": "300"
                },
                "orderer": "300"
            }
        }
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org4ebf3a6" class="outline-3">
<h3 id="org4ebf3a6">创建业务网卡</h3>
<div class="outline-text-3" id="text-org4ebf3a6">
<p>
业务网卡包含连接到业务网络和 Fabric 网络所需的所有信息. 使用 composer card create 来创建业务网卡.
</p>

<div class="org-src-container">
<pre class="src src-Shell">composer card create -p connection.json -u PeerAdmin -c Admin@org1.example.com-cert.pem -k 114aab0e76bf0c78308f89efc4b8c9423e31568da0c340ca187a9b17aa9a4457_sk -r PeerAdmin -r ChannelAdmin
</pre>
</div>

<p>
-p connection.json: 填写指向 connection.json 的路径.
</p>

<p>
-u PeerAdmin: 指定管理员的名称.
</p>

<p>
-c Admin@org1.example.com-cert.pem: 填写指向证书文件的路径, 路径为 fabric-dev-servers/fabric-scripts/hlfv11/composer/crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp
</p>

<p>
-k 114aab0e76bf0c78308f89efc4b8c9423e31568da0c340ca187a9b17aa9a4457_sk: 填写私钥文件路径, 存储在 keystore 里
</p>

<p>
完整的命令类似如下:
</p>
<div class="org-src-container">
<pre class="src src-Shell">composer card create -p connection.json -u PeerAdmin -c ../fabric-scripts/hlfv11/composer/crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp/signcerts/Admin@org1.example.com-cert.pem -k ../fabric-scripts/hlfv11/composer/crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp/keystore/114aab0e76bf0c78308f89efc4b8c9423e31568da0c340ca187a9b17aa9a4457_sk -r PeerAdmin -r ChannelAdmin
</pre>
</div>

<p>
这条命令会输出 .card 文件到当前目录.
</p>
</div>
</div>

<div id="outline-container-org6da58d9" class="outline-3">
<h3 id="org6da58d9">将业务网卡导入给 Fabric 管理员</h3>
<div class="outline-text-3" id="text-org6da58d9">
<div class="org-src-container">
<pre class="src src-Shell">composer card import -f PeerAdmin@fabric-network.card
</pre>
</div>
</div>
</div>

<div id="outline-container-org1bb107c" class="outline-3">
<h3 id="org1bb107c">将业务网络安装到节点上</h3>
<div class="outline-text-3" id="text-org1bb107c">
<p>
可以将这一步理解为在 Fabric 中的安装链码.
</p>
<div class="org-src-container">
<pre class="src src-Shell">composer network install -c PeerAdmin@fabric-network -a tutorial-network@0.0.1.bna
</pre>
</div>
</div>
</div>

<div id="outline-container-org3a1de32" class="outline-3">
<h3 id="org3a1de32">将 card 文件导入到业务网络</h3>
<div class="outline-text-3" id="text-org3a1de32">
<div class="org-src-container">
<pre class="src src-Shell">composer card import -f admin@tutorial-network.card
</pre>
</div>
</div>
</div>

<div id="outline-container-org227a51a" class="outline-3">
<h3 id="org227a51a">测试</h3>
<div class="outline-text-3" id="text-org227a51a">
<div class="org-src-container">
<pre class="src src-Shell">composer network ping -c admin@tutorial-network
</pre>
</div>
</div>
</div>
</div>

</div>
</div>
<div>
        <div class="post-meta">
            <span title="post date" class="post-info">2018-08-24</span>
            <span title="last modification date" class="post-info">2018-08-24</span>
            <span title="tags" class="post-info">:<a href="https://pinvondev.github.io/tags/blockchain">BlockChain</a>:</span>
            <span title="author" class="post-info"><a href="mailto:pinvon@Inspiron">Pinvon</a></span>
        </div>
    <script src="https://pinvondev.github.io/media/js/jquery-2.1.3.min.js"></script>
        <section>
            <h1>Comments</h1>
            <div id="comment-wrap">
                    <a class="disqus_label">使用 Disqus 评论</a>
    </ul>
        <div id="disqus_thread"></div>
        <script type="text/javascript">
         //var disqus_developer = 1;
         var preempt_signal=false;
         var disqus_identifier = "/blog/BlockChain/2018/08/24/hyperledger-composer/ Or /blog/BlockChain/hyperledger-composer/";
         var disqus_url = "https://pinvondev.github.io/blog/BlockChain/2018/08/24/hyperledger-composer/ Or /blog/BlockChain/hyperledger-composer/";
         var disqus_shortname = 'pinvon';
         /* * * DON'T EDIT BELOW THIS LINE * * */
         (function() {
             var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
             dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
             (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
             $('#disqus_thread').css('display','none');
         })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    <script>
     /* comments */
     var ego_disqus_thread=$('#disqus_thread');
     var ego_ds_label=$('.ds-thread');
     $('.disqus_label').click(function(){
         ego_disqus_thread.show();
         ego_ds_label.hide();
     });
     $('.ds-label').click(function(){
         ego_disqus_thread.hide();
         ego_ds_label.show();
     });
    </script>
        </section>
    <script src="https://pinvondev.github.io/media/js/main.js"></script>
    <div class="footer">
        <p>Generated by <a href="http://www.gnu.org/software/emacs/">Emacs</a> 25.x(<a href="http://orgmode.org">Org mode</a> 9.x)</p>
        <p>
            Copyright &copy; 2014 - <span id="footerYear"></span> <a href="mailto:pinvon@Inspiron">Pinvon</a>
            &nbsp;&nbsp;-&nbsp;&nbsp;
            Powered by <a href="https://github.com/emacs-china/ego" target="_blank">EGO</a><br/>
            <a href="http://creativecommons.org/licenses/by-sa/3.0/" rel="license"><img src="http://i.creativecommons.org/l/by-sa/3.0/88x31.png" style="border-width:0" alt="Creative Commons License" class="center"></a>
            <script type="text/javascript">document.getElementById("footerYear").innerHTML = (new Date()).getFullYear();</script>
        </p>
    </div>
            </div>
            <script type="text/javascript"
                    src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_SVG">
            </script>
            <script type="text/x-mathjax-config">
             MathJax.Hub.Config({ TeX: { equationNumbers: {autoNumber: "AMS"} } });
            </script>
            <script type="text/javascript" src="/media/js/love.js"></script>
</div>

  </div></body>
</html>
