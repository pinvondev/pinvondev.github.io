<!DOCTYPE html>
<html lang="en">
<head>
  <title>ip - Pinvon&#39;s Blog</title>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
  <meta name="author" content="Pinvon" />
  <style>
   #ds-thread #ds-reset .ds-comment-body p {color: #ffffff;}
   #ds-thread #ds-reset .ds-comment-body p a {color: #ff0;}
   #ds-thread #ds-reset .ds-comment-body p a:hover {color: #0ff;}
   #disqus_thread a {color: #00ffff;}
  </style>
  <link rel="stylesheet" href="https://pinvondev.github.io/media/css/main.css" type="text/css"/>
  <link rel="stylesheet" href="https://pinvondev.github.io/media/css/comment.css" type="text/css"/>
</head>

  <body><div class="container">
<div>
  <header class="masthead">
    <h1 class="masthead-title"><a href="https://pinvondev.github.io/">Pinvon&#39;s Blog</a></h1>
    <p>所见, 所闻, 所思, 所想</p>
    <nav class="site-nav">
      <div class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z" fill="#ffff00"/>
          <path d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z" fill="#ffff00"/>
          <path d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z" fill="#ffff00"/>
        </svg>
      </div>
      <ul class="trigger">
        <li><a href="https://pinvondev.github.io/years/">Years</a></li>
        <li><a href="https://pinvondev.github.io/authors/">Authors</a></li>
        <li><a href="https://pinvondev.github.io/tags/">Tags</a></li>
        <li><a href="https://pinvondev.github.io/about/">About</a></li>
        <li><a href="https://github.com/pinvondev">Github</a></li>
        <li><a href="https://pinvondev.github.io/rss.xml">RSS</a></li>
      </ul>
    </nav>
    <form method="get" id="searchform" action="http://www.google.com/search">
      <input type="text" class="field" name="q" id="s" placeholder="Search">
      <input type="hidden" name="as_sitesearch" value="pinvondev.github.io">
    </form>
  </header>
</div>

<div>
<div class="post">
<h1 class="title">ip</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgac8869a">1. IP 地址的分类</a></li>
<li><a href="#org7d3168b">2. 网络号和主机号</a></li>
<li><a href="#org01b8aee">3. 特殊的IP地址</a>
<ul>
<li><a href="#org78f3617">3.1. 主机号全 0</a></li>
<li><a href="#org48f9770">3.2. 主机号全 1</a></li>
<li><a href="#org6658e80">3.3. 32 位全 1</a></li>
<li><a href="#org2d779e8">3.4. 主机本身地址</a></li>
<li><a href="#org38481c5">3.5. 回环地址</a></li>
<li><a href="#orgd68c004">3.6. 专用 IP 地址</a></li>
</ul>
</li>
<li><a href="#org315ad4a">4. 子网划分</a></li>
<li><a href="#org98b3a7b">5. 数据报分片</a>
<ul>
<li><a href="#org6480ad1">5.1. 最大传送单元(MTU)</a></li>
</ul>
</li>
<li><a href="#orge4f009f">6. 校验和</a></li>
<li><a href="#orge495c8f">7. 交付与转发</a>
<ul>
<li><a href="#org0364485">7.1. 交付</a>
<ul>
<li><a href="#org7b94569">7.1.1. 连接类型</a></li>
<li><a href="#orge3300cc">7.1.2. 直接交付</a></li>
<li><a href="#orga66146e">7.1.3. 间接交付</a></li>
</ul>
</li>
<li><a href="#orgfd458de">7.2. 转发</a>
<ul>
<li><a href="#org11b355d">7.2.1. 下一跳方法</a></li>
<li><a href="#org7fc02d9">7.2.2. 特定网络方法</a></li>
<li><a href="#org2444fca">7.2.3. 特定主机方法</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgf666e1b">8. 习题</a></li>
</ul>
</div>
</div>
<div id="outline-container-orgac8869a" class="outline-2">
<h2 id="orgac8869a"><span class="section-number-2">1</span> IP 地址的分类</h2>
<div class="outline-text-2" id="text-1">
<p>
分成了 ABCDE 五类. 其中, ABC 是基本的 Internet 地址, 供用户使用. D 类地址用于广播, E 类地址为保留地址.
</p>

<p>
这五类地址, 用最前面的 4bit 来区分. 如:
</p>


<div class="figure">
<p><img src="https://pinvondev.github.io/assets/blog/2018/05/02/ip/2.png" alt="2.png" />
</p>
</div>

<p>
由于 A 类地址的第 1 位已经用掉了, 剩下的 7 位能表示的最大数为 127. 所以 A 类地址第一个字节的范围是 0~127. 其他地址类似.
</p>

<p>
B类: 128~191
</p>

<p>
C类: 192~223
</p>

<p>
D类: 224~239
</p>

<p>
E类: 240~255
</p>
</div>
</div>

<div id="outline-container-org7d3168b" class="outline-2">
<h2 id="org7d3168b"><span class="section-number-2">2</span> 网络号和主机号</h2>
<div class="outline-text-2" id="text-2">
<p>
ABC 类地址能划分网络号和主机号, DE 类地址不划分.
</p>

<p>
A 类地址的网络号是第 1 个字节, 剩下的 3 个字节用于主机号.
</p>

<p>
B 类地址的网络号是前 2 个字节, 剩下的 2 个字节用于主机号.
</p>

<p>
C 类地址的网络号是前 3 个字节, 剩下的 1 个字节用于主机号.
</p>
</div>
</div>

<div id="outline-container-org01b8aee" class="outline-2">
<h2 id="org01b8aee"><span class="section-number-2">3</span> 特殊的IP地址</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-org78f3617" class="outline-3">
<h3 id="org78f3617"><span class="section-number-3">3.1</span> 主机号全 0</h3>
<div class="outline-text-3" id="text-3-1">
<p>
主机号全 0 的 IP 地址不分配给任何主机, 作为网络本身的标识.
</p>
</div>
</div>

<div id="outline-container-org48f9770" class="outline-3">
<h3 id="org48f9770"><span class="section-number-3">3.2</span> 主机号全 1</h3>
<div class="outline-text-3" id="text-3-2">
<p>
直接广播地址. 目的地址为直接广播地址的数据包将会发送到网络中的所有节点. (但能否执行广播, 依赖于支撑的物理网络是否具有广播功能)
</p>
</div>
</div>

<div id="outline-container-org6658e80" class="outline-3">
<h3 id="org6658e80"><span class="section-number-3">3.3</span> 32 位全 1</h3>
<div class="outline-text-3" id="text-3-3">
<p>
有限广播地址, 通常由无盘工作站启动时使用. 希望从网络 IP 地址服务器处获得一个 IP 地址.
</p>
</div>
</div>

<div id="outline-container-org2d779e8" class="outline-3">
<h3 id="org2d779e8"><span class="section-number-3">3.4</span> 主机本身地址</h3>
<div class="outline-text-3" id="text-3-4">
<p>
32 位全 0.
</p>
</div>
</div>

<div id="outline-container-org38481c5" class="outline-3">
<h3 id="org38481c5"><span class="section-number-3">3.5</span> 回环地址</h3>
<div class="outline-text-3" id="text-3-5">
<p>
127.0.0.1 用于本机上软件测试和本机上网络应用程序之间的通信地址.
</p>
</div>
</div>

<div id="outline-container-orgd68c004" class="outline-3">
<h3 id="orgd68c004"><span class="section-number-3">3.6</span> 专用 IP 地址</h3>
<div class="outline-text-3" id="text-3-6">
<p>
10.0.0.0 - 10.255.255.255
</p>

<p>
172.16.0.0 - 172.31.255.255
</p>

<p>
192.168.0.0 - 192.168.255.255
</p>
</div>
</div>
</div>
<div id="outline-container-org315ad4a" class="outline-2">
<h2 id="org315ad4a"><span class="section-number-2">4</span> 子网划分</h2>
<div class="outline-text-2" id="text-4">
<p>
子网编址把 IP 地址中的主机号进一步细分成子网号和主机号. 因此, 子网编址 = 网络号 + 子网号 + 主机号. 如, B 类网络地址可以这样进行子网编址:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">16 位</th>
<th scope="col" class="org-left">8 位</th>
<th scope="col" class="org-left">8 位</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">网络号</td>
<td class="org-left">子网号</td>
<td class="org-left">主机号</td>
</tr>
</tbody>
</table>

<p>
子网掩码: 值为 1 的位为网络号和子网号; 值为 0 的位为主机号.
</p>

<p>
于是, 给定一个 IP 地址和子网掩码, 可以先确定这个 IP 地址是 A 类, B 类还是 C 类地址, 然后根据子网掩码确定其主机号, 这样子网号也就确定了.
</p>
</div>
</div>

<div id="outline-container-org98b3a7b" class="outline-2">
<h2 id="org98b3a7b"><span class="section-number-2">5</span> 数据报分片</h2>
<div class="outline-text-2" id="text-5">
<p>
数据包可能通过多个不同的网络, 不同网络中帧的格式和长度与这个帧所处的物理网络使用的协议有关. 如, 将以太网的帧通过路由器发送到广域网, 路由器接收的是以太网的帧格式, 发送的是广域网的帧格式.
</p>
</div>

<div id="outline-container-org6480ad1" class="outline-3">
<h3 id="org6480ad1"><span class="section-number-3">5.1</span> 最大传送单元(MTU)</h3>
<div class="outline-text-3" id="text-5-1">
<p>
MTU 是最大传送单元, 不同网络的 MTU 是不同的.
</p>

<p>
数据包可以在源主机和传播路径上的路由器上进行分片, 但只能在目的主机上进行重装.
</p>

<p>
MTU 一般不包含该层的首部和尾部. 比如, 以太网中, MTU 一般为 1500B, 这里的内容就是 IP 数据报, 而不包括以太网中的首部和尾部.
</p>
</div>
</div>
</div>

<div id="outline-container-orge4f009f" class="outline-2">
<h2 id="orge4f009f"><span class="section-number-2">6</span> 校验和</h2>
<div class="outline-text-2" id="text-6">
<p>
IP 数据包的校验和只校验 IP 首部部分, 而不校验 IP 数据部分. 因为如果数据是高层协议的, 高层协议中有覆盖整个数据包的校验和, 因此 IP 数据报的校验和不必再校验所封装的数据部分.
</p>

<p>
另外, 每经过一个路由器, IP 数据包的首部都会改变一次, 而数据部分则不改变, 如果每次校验都包括数据部分, 会严重浪费资源.
</p>
</div>
</div>

<div id="outline-container-orge495c8f" class="outline-2">
<h2 id="orge495c8f"><span class="section-number-2">7</span> 交付与转发</h2>
<div class="outline-text-2" id="text-7">
<p>
交付: 在网络层的控制下, 一个数据包被底层网络处理的方式.
</p>

<p>
转发: 数据包被交付到下一站的方式.
</p>
</div>

<div id="outline-container-org0364485" class="outline-3">
<h3 id="org0364485"><span class="section-number-3">7.1</span> 交付</h3>
<div class="outline-text-3" id="text-7-1">
<p>
交付过程中, 有几个重要的概念: 连接类型, 直接交付, 间接交付.
</p>
</div>

<div id="outline-container-org7b94569" class="outline-4">
<h4 id="org7b94569"><span class="section-number-4">7.1.1</span> 连接类型</h4>
<div class="outline-text-4" id="text-7-1-1">
<p>
面向连接服务(虚电路): 在发送数据包之前先建立一条连接, 以后所有数据包都沿该路径, 按序发送, 当数据包发送完毕, 则连接终止.
</p>

<p>
无连接服务: 网络协议对待每个数据包都是独立的, 与其他数据包没有关系. 每个数据包有自己的路径到达目的地, 其到达顺序也没有规定.
</p>

<p>
可以看出, 面向连接服务中, 路由器不需要对每个数据包重新计算路由, 效率较高. 注意, IP 协议是无连接协议, 提供的是无连接服务.
</p>
</div>
</div>

<div id="outline-container-orge3300cc" class="outline-4">
<h4 id="orge3300cc"><span class="section-number-4">7.1.2</span> 直接交付</h4>
<div class="outline-text-4" id="text-7-1-2">
<p>
数据包的源点和终点在同一个物理网络上. 源主机根据目的主机的 IP 地址, 就可以判断是否在同一物理网络.
</p>
</div>
</div>

<div id="outline-container-orga66146e" class="outline-4">
<h4 id="orga66146e"><span class="section-number-4">7.1.3</span> 间接交付</h4>
<div class="outline-text-4" id="text-7-1-3">
<p>
间接交付就是指源点和终点不在同一个物理网络上的情况.
</p>

<p>
间接交付必然包括一个直接交付, 若干个间接交付.
</p>
</div>
</div>
</div>

<div id="outline-container-orgfd458de" class="outline-3">
<h3 id="orgfd458de"><span class="section-number-3">7.2</span> 转发</h3>
<div class="outline-text-3" id="text-7-2">
<p>
过去, 通过查找路由表来确定下一跳. 但是现在已经变得不可能, 因为路由表中的项目数太多, 使得查找效率低下. 下面介绍三种现在比较常见的方法.
</p>
</div>

<div id="outline-container-org11b355d" class="outline-4">
<h4 id="org11b355d"><span class="section-number-4">7.2.1</span> 下一跳方法</h4>
<div class="outline-text-4" id="text-7-2-1">
<p>
每个路由表中只保留下一跳的地址, 而不保留完整的路由信息.
</p>


<div class="figure">
<p><img src="https://pinvondev.github.io/assets/blog/2018/05/02/ip/3.png" alt="3.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-org7fc02d9" class="outline-4">
<h4 id="org7fc02d9"><span class="section-number-4">7.2.2</span> <a id="orge7e0af7"></a>特定网络方法</h4>
<div class="outline-text-4" id="text-7-2-2">
<p>
把同一个网络内的所有主机, 都当成是一个路由表项.
</p>


<div class="figure">
<p><img src="https://pinvondev.github.io/assets/blog/2018/05/02/ip/4.png" alt="4.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-org2444fca" class="outline-4">
<h4 id="org2444fca"><span class="section-number-4">7.2.3</span> 特定主机方法</h4>
<div class="outline-text-4" id="text-7-2-3">
<p>
特定主机方法将目的主机地址在路由表中全部给出, 这与<a href="#orge7e0af7">特定网络方法</a>的思想是相反的. 效率较低.
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-orgf666e1b" class="outline-2">
<h2 id="orgf666e1b"><span class="section-number-2">8</span> 习题</h2>
<div class="outline-text-2" id="text-8">
<ul class="org-ul">
<li>MTU 设置成较大时的好处, 设置成较小时的好处?</li>
</ul>

<p>
使用大的 MTU 可以在较少的报文中包含较多的数据, 报文数量的减少可以降低路由器的负荷.
</p>

<p>
在不同的网络中进行传输时, 如果使用小点的 MTU, 就可以减少路由器对原网络的帧进行分片的可能性.
</p>

<ul class="org-ul">
<li>如何分片?</li>
</ul>

<p>
在 IP 首部中:
</p>

<p>
<code>More Fragments</code> 字段值为 1, 表示后面还有分片.
</p>

<p>
<code>Fragment offset</code> 字段值表明在所有分片重组时, 当前分片的位置.
</p>

<p>
如果低层协议的 MTU 为 800, 则低层传输的数据量最大为 800-20(IP 首部长度)=780, 而 MTU 一般需要是 8 的整数倍. 所以既是8的整数倍, 又是最接近 780 的数, 就是 776. 因此, 在这个例子中, 第一个分片的偏移量是 0, 第二个分片的偏移量是 776.
</p>
</div>
</div>

</div>
</div>
<div>
        <div class="post-meta">
            <span title="post date" class="post-info">2018-05-02</span>
            <span title="last modification date" class="post-info">2018-05-02</span>
            <span title="tags" class="post-info">:N/A:</span>
            <span title="author" class="post-info"><a href="mailto:pinvon@Inspiron">Pinvon</a></span>
        </div>
    <script src="https://pinvondev.github.io/media/js/jquery-2.1.3.min.js"></script>
        <section>
            <h1>Comments</h1>
            <div id="comment-wrap">
                    <a class="disqus_label">使用 Disqus 评论</a>
    </ul>
        <div id="disqus_thread"></div>
        <script type="text/javascript">
         //var disqus_developer = 1;
         var preempt_signal=false;
         var disqus_identifier = "/blog/2018/05/02/ip/";
         var disqus_url = "https://pinvondev.github.io/blog/2018/05/02/ip/";
         var disqus_shortname = 'pinvon';
         /* * * DON'T EDIT BELOW THIS LINE * * */
         (function() {
             var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
             dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
             (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
             $('#disqus_thread').css('display','none');
         })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    <script>
     /* comments */
     var ego_disqus_thread=$('#disqus_thread');
     var ego_ds_label=$('.ds-thread');
     $('.disqus_label').click(function(){
         ego_disqus_thread.show();
         ego_ds_label.hide();
     });
     $('.ds-label').click(function(){
         ego_disqus_thread.hide();
         ego_ds_label.show();
     });
    </script>
        </section>
    <script src="https://pinvondev.github.io/media/js/main.js"></script>
    <div class="footer">
        <p>Generated by <a href="http://www.gnu.org/software/emacs/">Emacs</a> 25.x(<a href="http://orgmode.org">Org mode</a> 9.x)</p>
        <p>
            Copyright &copy; 2014 - <span id="footerYear"></span> <a href="mailto:pinvon@Inspiron">Pinvon</a>
            &nbsp;&nbsp;-&nbsp;&nbsp;
            Powered by <a href="https://github.com/emacs-china/ego" target="_blank">EGO</a><br/>
            <a href="http://creativecommons.org/licenses/by-sa/3.0/" rel="license"><img src="http://i.creativecommons.org/l/by-sa/3.0/88x31.png" style="border-width:0" alt="Creative Commons License" class="center"></a>
            <script type="text/javascript">document.getElementById("footerYear").innerHTML = (new Date()).getFullYear();</script>
        </p>
    </div>
            </div>
            <script type="text/javascript"
                    src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_SVG">
            </script>
            <script type="text/x-mathjax-config">
             MathJax.Hub.Config({ TeX: { equationNumbers: {autoNumber: "AMS"} } });
            </script>
</div>

  </div></body>
</html>
