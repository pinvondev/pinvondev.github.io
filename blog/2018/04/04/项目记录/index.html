<!DOCTYPE html>
<html lang="en-us">
  <head>
    <title>项目记录 - Pinvon&#39;s Blog</title>
    <meta charset="utf-8" />
    <meta name="author" content="Pinvon" />
    <meta name="description" content="&lt;TODO: insert your description here&gt;" />
    <meta name="keywords" content="&lt;TODO: insert your keywords here&gt;" />
    <link rel="stylesheet" href="/media/css/main.css" type="text/css">
    <link rel="stylesheet" href="/media/css/prettify.css" type="text/css">
  </head>
  <body class="container">
    <div>
      <header class="masthead">
        <h1 class="masthead-title"><a href="/">Pinvon&#39;s Blog</a></h1>
        <p>所见，所闻，所思，所想</p>
        <ul>
          <li><a href="/blog/">Blog</a></li>
          <li><a href="/tags/">Tags</a></li>
          <li><a href="/about/">About</a></li>
          <li><a href="https://github.com/pinvondev">GitHub</a></li>
          <li><a href="/rss.xml">RSS</a></li>
        </ul>
        <form method="get" id="searchform" action="//www.google.com/search">
          <input type="text" class="field" name="q" id="s" placeholder="Search">
          <input type="hidden" name="as_sitesearch" value="pinvondev.github.io">
        </form>
      </header>
    </div>

<div>
<div class="post">
<h1>项目记录</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org312760b">环境搭建</a>
<ul>
<li><a href="#org677bc19">前提</a></li>
<li><a href="#org400aa76">下载代码</a></li>
<li><a href="#org87225f4">启动网络</a></li>
<li><a href="#orga83594e">启动marbles</a>
<ul>
<li><a href="#orgb00e706">chaincode</a></li>
<li><a href="#org955725c">启动marbles</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org74553eb">程序介绍</a></li>
<li><a href="#orgce09df5">区块链背景</a>
<ul>
<li><a href="#org6313169">定义</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-org312760b" class="outline-2">
<h2 id="org312760b">环境搭建</h2>
<div class="outline-text-2" id="text-org312760b">
</div>
<div id="outline-container-org677bc19" class="outline-3">
<h3 id="org677bc19">前提</h3>
<div class="outline-text-3" id="text-org677bc19">
<p>
安装git, go, docker, node.js
</p>
</div>
</div>

<div id="outline-container-org400aa76" class="outline-3">
<h3 id="org400aa76">下载代码</h3>
<div class="outline-text-3" id="text-org400aa76">
<div class="org-src-container">
<pre class="src src-Shell">git clone https://github.com/IBM-Blockchain/marbles.git
cd marble
</pre>
</div>
</div>
</div>

<div id="outline-container-org87225f4" class="outline-3">
<h3 id="org87225f4">启动网络</h3>
<div class="outline-text-3" id="text-org87225f4">
<div class="org-src-container">
<pre class="src src-Shell">git clone https://github.com/hyperledger/fabric-samples
cd fabric-samples
git checkout v1.0.1

curl -sSL https://goo.gl/6wtTN5 | bash -s 1.0.0
# 或者
curl -sSL https://raw.githubusercontent.com/hyperledger/fabric/master/scripts/bootstrap.sh | bash -s 1.0.0

# 设置环境变量
export PATH=$PWD/bin:$PATH

cd fabcar
./startFabric.sh

# 安装依赖
sudo npm install

# 如果要关闭网络
cd ../bashic-network
./stop.sh
./teardown.sh
</pre>
</div>
</div>
</div>

<div id="outline-container-orga83594e" class="outline-3">
<h3 id="orga83594e">启动marbles</h3>
<div class="outline-text-3" id="text-orga83594e">
</div>
<div id="outline-container-orgb00e706" class="outline-4">
<h4 id="orgb00e706">chaincode</h4>
<div class="outline-text-4" id="text-orgb00e706">
<p>
进入marbles根目录.
</p>

<p>
修改 <code>config/connection_profile_local.json</code>:
</p>
<div class="org-src-container">
<pre class="src src-JSON">"credentialStore": {
            "path": "/home/pinvon/go/src/github.com/hyperledger/project/fabric-samples/fabcar/creds"
        }

"x-certJson": {
                "path": "/home/pinvon/go/src/github.com/hyperledger/project/fabric-samples/fabcar/creds/PeerAdmin"
            }

"registrar": [
                {
                    "enrollId": "PeerAdmin",
                    "enrollSecret": "PeerAdminpw"
                }
            ],
</pre>
</div>

<div class="org-src-container">
<pre class="src src-Shell"># 安装chaincode
cd ./scripts
node install_chaincode.js

# 实例化chaincode
node instantiate_chaincode.js
</pre>
</div>
</div>
</div>

<div id="outline-container-org955725c" class="outline-4">
<h4 id="org955725c">启动marbles</h4>
<div class="outline-text-4" id="text-org955725c">
<div class="org-src-container">
<pre class="src src-Shell"> npm install gulp -g
#  如果失败, npm config seregistry http://registry.cnpmjs.org 再执行.
npm install
gulp marbles_local
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-org74553eb" class="outline-2">
<h2 id="org74553eb">程序介绍</h2>
<div class="outline-text-2" id="text-org74553eb">
<p>
chaincode会创建资产, 将它存储到chaincode状态中. 资产在区块链存储(账本)中以键值对的形式创建. 账本与chaincode的交互通过对网络上的一个节点使用gRPC协议来完成. gRPC协议的细节由<a href="https://www.npmjs.com/package/fabric-client">Hyperledger Fabric Client</a> SDK处理.
</p>

<p>
项目以<a href="https://github.com/IBM-Blockchain/marbles">Marbles</a>为基础进行修改. 因此, 以Marbles程序的图片来进行介绍.
</p>


<div class="figure">
<p><img src="/assets/blog/2018/04/04/项目记录/29.png" alt="29.png" />
</p>
</div>

<ol class="org-ol">
<li>admin通过浏览器与Marbles交互.</li>
<li>客户端JS代码打开一个与后端Node.js应用程序的Websocket连接. admin与该站点交互时, 客户端JS将消息发送到后端.</li>
<li>读取或写入账本称为提案. 提案由Marbles通过SDK构建, 然后发送到一个区块链节点.</li>
<li>该节点将与它的Marbles chaincode容器进行通信. chaincode将运行/模拟该交易. 如果没有 问题, 它会对该交易进行背书, 并将其发回Marbles程序.</li>
<li>Marbles通过SDK将背书后的提案发送到Orderer Service, Orderer Service将来自整个网络的许多提案打包到一个区块中, 然后, 它将新的区块广播到网络中的节点.</li>
<li>最后, 节点会验证该区块, 并将它写入自己的账本中. 该交易现已生效, 所有节点都会过来同步账本.</li>
</ol>

<p>
程序的架构主要分成3个部分:
</p>
<ol class="org-ol">
<li>chaincode: 位于 <code>/chaincode</code>.</li>
<li>客户端: 用户浏览器中所运行的JavaScript代码, 位于 <code>/public/js</code> 中.</li>
<li>服务端: 核心部分, 它充当admin与区块链之间的连接器, 位于 <code>/utils &amp; /routes</code> 中.</li>
</ol>
</div>
</div>

<div id="outline-container-orgce09df5" class="outline-2">
<h2 id="orgce09df5">区块链背景</h2>
<div class="outline-text-2" id="text-orgce09df5">
</div>
<div id="outline-container-org6313169" class="outline-3">
<h3 id="org6313169">定义</h3>
<div class="outline-text-3" id="text-org6313169">
<p>
节点: 节点是区块链的成员, 运行着Hyperledger Fabric. 在marbles中, 节点归弹珠公司所有和操作.
</p>

<p>
CA: CA负责守卫我们的区块链网络. 它为客户端(如 Marbles node.js 应用程序)提供交易证书.
</p>

<p>
Orderer: 主要职责是将交易打包到区块中.
</p>

<p>
区块: 包含交易和一个验证完整性的哈希值.
</p>

<p>
交易或提案: 表示与区块链账本的交互. 对账本的读取和写入都是以交易/提案的形式发送的.
</p>

<p>
账本: 区块链在一个节点上的存储区. 它包含由交易参数和键值对组成的实际的区块数据. 由chaincode编写.
</p>

<p>
chaincode: 定义资产和所有关于资产的规则.
</p>

<p>
资产: 存在于账本中的实体. 它是一种键值对, 在Marbles中, 资产是一颗弹珠, 或弹珠所有者.
</p>

<p>
创建一颗弹珠时, 涉及的操作:
</p>
<ol class="org-ol">
<li>向网络的CA注册管理员用户. 如果成功, CA会向Marbles发送注册证书, SDK将证书存储在本地文件系统中.</li>
<li>管理员从用户界面创建一颗新弹珠时, SDK会创建一个调用事务.</li>
<li>创建弹珠的事务被构建为一个调用链代码函数 <code>init_marble()</code> 的提案.</li>
<li>Marbles通过SDK将此提案发送到一个节点进行背书.</li>
<li>节点运行 <code>init_marble()</code> 来模拟该事务, 并记录它尝试写入账本中的所有更改.</li>
<li>如果该函数成功返回, 节点会对该提案进行背书, 并将它发回Marbles. 如果失败, 错误也会发送回来, 但不会对提案进行背书.</li>
<li>Marbles通过SDK将背书后的提案发送到Orderer.</li>
<li>Orderer将组织来自整个网络的提案的序列. 它通过查找相互冲突的交易, 检查该交易序列是否有效. 任何由于冲突无法添加到区块中的交易都被标记为错误.</li>
<li>Orderer将新区块广播到网络中的节点.</li>
<li>节点收到新区块, 并通过查看各种签名和哈希值来验证它. 最后将该区块提交到节点的账本.</li>
<li>账本中会出现新的弹珠, 并很快会出现在所有节点的账本中.</li>
</ol>
</div>
</div>
</div>

</div>
</div>
    <div>
      <div class="post-meta">
        <span title="post date" class="post-info">2018-04-04</span>
        <span title="last modification date" class="post-info">2018-04-06</span>
        <span title="tags" class="post-info"><a href="/tags/blockchain/">BlockChain</a></span>
        <span title="author" class="post-info">Pinvon</span>
      </div>
      <section>
        <h1>Comments</h1>
        <div id="disqus_thread"></div>
        <script type="text/javascript">
          //var disqus_developer = 1;
          var disqus_identifier = "/blog/2018/04/04/项目记录";
          var disqus_url = "http://pinvondev.github.io/blog/2018/04/04/项目记录";
          var disqus_shortname = 'pinvon';
          /* * * DON'T EDIT BELOW THIS LINE * * */
          (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="//disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
       <div id="hashover"></div>
       <script type="text/javascript" src="/hashover.php"></script>
       <noscript>You must have JavaScript enabled to use the comments.</noscript>
      </section>
      <script src="//code.jquery.com/jquery-latest.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.js"></script>
      <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      <script src="/media/js/main.js"></script>
      <div class="footer">
        <p>Generated by <a href="http://www.gnu.org/software/emacs/">Emacs</a> 25.x (<a href="http://orgmode.org">Org mode</a> 9.x)</p>
        <p>
          Copyright &copy; 2012 - <span id="footerYear"></span> <a href="mailto:pinvon &lt;at&gt; Inspiron">Pinvon</a>
          &nbsp;&nbsp;-&nbsp;&nbsp;
          Powered by <a href="https://github.com/kelvinh/org-page" target="_blank">org-page</a>
          <script type="text/javascript">document.getElementById("footerYear").innerHTML = (new Date()).getFullYear();</script>
        </p>
      </div>
    </div>

  </body>
</html>
